
digraph OptimizationPipeline {
    rankdir=LR;
    nodesep=0.6; 
    ranksep=0.7;
    splines=ortho;
    compound=true;
    node [shape=rect, style="filled,rounded", fontname="Helvetica", fontsize=11, margin="0.2,0.1"];
    edge [fontname="Helvetica", fontsize=9, color="#444444", arrowsize=0.8];

    # Title
    labelloc="t";
    label="Neural CDE Iron Condor System\nEnd-to-End Optimization Architecture";
    fontsize=18;
    bgcolor="#0a0a0a";

    # --- Data Sources ---
    subgraph cluster_data {
        label = "1. Data Acquisition";
        style="dashed,rounded";
        color="#888888";
        fontcolor="white";
        bgcolor="#0a0a0a";
        
        {rank=same; Alpaca; OptionsData}
        Alpaca [label="Alpaca Intraday\n(15-Min Bars)", fillcolor="#1a237e", color="white", fontcolor="white"];
        OptionsData [label="Option Feed\n(IVolatility)", fillcolor="#1a237e", color="white", fontcolor="white"];
    }

    # --- Training Pipeline ---
    subgraph cluster_training {
        label = "2. Neural Training (Offline)";
        style="filled,rounded";
        color="#424242";
        fontcolor="white";
        bgcolor="#0a0a0a";
        
        TrainScript [label="Train Harness\n(train_condor_brain.py)", shape=component, fillcolor="#b71c1c", color="white", fontcolor="white"];
        
        subgraph cluster_model {
            label = "Neural CDE Network";
            style=filled;
            color="#212121";
            fontcolor="white";
            
            CDE [label="Neural CDE Backbone\n(Explicit Euler Integration)\n[Continuous Time Modeling]", shape=octagon, fillcolor="#880e4f", color="white", fontcolor="white"];
        }

        ModelWeights [label="Model Weights\n(condor_brain_cde_prod.pth)", shape=note, fillcolor="#f57f17", color="white", fontcolor="white"];
        
        Alpaca -> TrainScript [label="Fetch History", color="white", fontcolor="white"];
        TrainScript -> CDE [label="Train (GPU)", color="white", fontcolor="white"];
        CDE -> ModelWeights [label="Save State", color="white", fontcolor="white"];
    }

    # --- Production Runtime ---
    subgraph cluster_runtime {
        label = "3. Production Optimizer (Runtime)";
        style="filled,rounded";
        color="#2e7d32";
        fontcolor="white";
        bgcolor="#0a0a0a";
        
        Optimizer [label="Optimizer Engine\n(Segmented Grid Search)", shape=hexagon, fillcolor="#1b5e20", color="white", fontcolor="white", fontsize=12, penwidth=2];
        
        subgraph cluster_backtest {
            label = "Backtest Instance";
            style=filled;
            color="#212121";
            fontcolor="white";
            
            Inference [label="Inference Engine\n(Batch GPU Pre-Compute)", fillcolor="#e64a19", color="white", fontcolor="white"];
            Strategy [label="Iron Condor Strategy\n(4-Leg Execution)", shape=folder, fillcolor="#33691e", color="white", fontcolor="white"];
            
            Inference -> Strategy [label="Regime Signal", color="white", fontcolor="white"];
        }

        Metrics [label="Profit / MaxDD\nReport", shape=ellipse, fillcolor="#424242", color="white", fontcolor="white"];
        
        Optimizer -> Strategy [label="Inject Params", style=dashed, color="white", fontcolor="white"];
        Strategy -> Metrics [label="Result", color="white", fontcolor="white"];
        Metrics -> Optimizer [label="Feedback", color="white", fontcolor="white"];
    }

    # Inter-Cluster Edges
    ModelWeights -> Inference [label="Load Weights", lhead=cluster_backtest, color="white", fontcolor="white"];
    OptionsData -> Strategy [label="Tick Data", color="white", fontcolor="white"];
    

    // Copyright Notice
    subgraph cluster_copyright {
        style=invis;
        rank=sink;
        node [shape=plaintext, fontsize=10, fontcolor="#777777", fontname="Helvetica"];
        copyright_note [label="Â© 2026 by Dr. T. Jerry Mahabub, Ph.D\nAll rights reserved."];
    }

}